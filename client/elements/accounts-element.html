<link rel="import" href="../bower_components/webcomponentsjs/webcomponents.js">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/polymer-currency-filter/polymer-currency-filter.html">

<polymer-element name="accounts-element">
  <template>
    <span>I'm <b>my-element</b>. This is my Shadow DOM.</span>
    <!-- Be sure to use an acutal protocol like http or it complains -->
    <core-ajax url="http://localhost:9999/api/getAccounts" auto response="{{accounts}}" handleAs="json"></core-ajax>
    <p>The number of accounts is {{accounts.length}}</p>
    <template repeat="{{account, i in accounts}}">
      <span><p>{{account.firstName}} {{account.lastName}}, # of transactions: {{account.transactions.length}}</p></span>
        <template repeat="{{transaction in accounts[i].transactions}}">
          <p>{{transaction.transactionId}}, {{transaction.amount | currency}}<p>
        </template>
    </template>
  </template>
  <!-- need Polymer declaration or the whole thing does not work. If you remove the Polymer declaration add `noscript` to the polymer-element declaration -->
  <script>
    Polymer('accounts-element', {
        getTransactions: function(account) {
          transactions = account.transactions;
        },

        sort: function(items) {
          items.sort(function(a,b) {
            var indexA = a.transactionId, indexB = b.transactionId;
            if (indexA > indexB) return 1;
            if (indexA < indexB) return -1;
            return 0;
          });
          return items;
        }
      });
  </script>
</polymer-element>
